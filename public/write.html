<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¸€ì“°ê¸°</title>
</head>
<body>
  <h1>ğŸ“„ ê¸€ì“°ê¸°</h1>
  <form id="write-form">
    <input type="text" id="title" placeholder="ì œëª©" required><br><br>
    <textarea id="content" placeholder="ë‚´ìš©" rows="10" cols="50" required></textarea><br><br>
    <button type="submit">ì‘ì„± ì™„ë£Œ</button>
  </form>

  <script>
    async function checkLogin() {
      const res = await fetch('/api/auth/me');
      if (!res.ok) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        location.href = '/login.html';
      }
    }

    document.getElementById('write-form').onsubmit = async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;

      const res = await fetch('/api/posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, content })
      });

      if (res.ok) {
        alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        location.href = '/';
      } else {
        const data = await res.json();
        alert('ë“±ë¡ ì‹¤íŒ¨: ' + (data.error || 'ì„œë²„ ì˜¤ë¥˜'));
      }
    };

    checkLogin();
  </script>
</body>
</html>
